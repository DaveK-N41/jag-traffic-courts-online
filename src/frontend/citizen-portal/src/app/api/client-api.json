{
  "openapi": "3.0.1",
  "info": {
    "title": "Traffic Court Online Citizen Api",
    "description": "An API for creating violation ticket disputes",
    "version": "v1"
  },
  "paths": {
    "/api/disputes/create": {
      "post": {
        "tags": [
          "Disputes"
        ],
        "summary": "An endpoint for creating and saving dispute ticket data",
        "requestBody": {
          "description": "",
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/TicketDispute"
              }
            },
            "text/json": {
              "schema": {
                "$ref": "#/components/schemas/TicketDispute"
              }
            },
            "application/*+json": {
              "schema": {
                "$ref": "#/components/schemas/TicketDispute"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Success"
          }
        }
      }
    },
    "/api/lookup/statutes": {
      "get": {
        "tags": [
          "Lookup"
        ],
        "summary": "Returns a list of Violation Ticket Statutes filtered by given section text (if provided).",
        "parameters": [
          {
            "name": "section",
            "in": "query",
            "description": "Motor vehicle act Section text to query by, ie \"13(1)(a)\" returns \"Motor Vehicle or Trailer without Licence\" contravention, or blank for no filter.",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Success",
            "content": {
              "application/json": {
                "schema": {
                  "type": "array",
                  "items": {
                    "$ref": "#/components/schemas/Statute"
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/tickets/search": {
      "get": {
        "tags": [
          "Tickets"
        ],
        "summary": "Searches for a violation ticket that exists on file.",
        "parameters": [
          {
            "name": "ticketNumber",
            "in": "query",
            "description": "The violation ticket number. Must start with two upper case letters and end with eight digits.",
            "required": true,
            "schema": {
              "pattern": "^[A-Z]{2}[0-9]{8}$",
              "type": "string"
            }
          },
          {
            "name": "time",
            "in": "query",
            "description": "The time the violation ticket number was issued. Must be formatted a valid 24-hour clock, HH:MM.",
            "required": true,
            "schema": {
              "pattern": "^(2[0-3]|[01]?[0-9]):([0-5]?[0-9])$",
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "The violation ticket was found.",
            "content": {
              "text/plain": {
                "schema": {
                  "$ref": "#/components/schemas/TicketSearchResult"
                }
              },
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/TicketSearchResult"
                }
              },
              "text/json": {
                "schema": {
                  "$ref": "#/components/schemas/TicketSearchResult"
                }
              }
            }
          },
          "404": {
            "description": "The violation ticket was not found.",
            "content": {
              "text/plain": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "text/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          },
          "500": {
            "description": "There was a server error that prevented the search from completing successfully."
          },
          "400": {
            "description": "The request was not well formed. Check the parameters."
          }
        }
      }
    },
    "/api/tickets/analyse": {
      "post": {
        "tags": [
          "Tickets"
        ],
        "summary": "Analyses a Traffic Violation Ticket, extracting all hand-written text to a consumable JSON object.",
        "requestBody": {
          "content": {
            "multipart/form-data": {
              "schema": {
                "required": [
                  "file"
                ],
                "type": "object",
                "properties": {
                  "file": {
                    "type": "string",
                    "format": "binary"
                  }
                }
              },
              "encoding": {
                "file": {
                  "style": "form"
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "The file appears to be a valid Violation Ticket. JSON data is extracted.",
            "content": {
              "text/plain": {
                "schema": {
                  "$ref": "#/components/schemas/OcrViolationTicket"
                }
              },
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/OcrViolationTicket"
                }
              },
              "text/json": {
                "schema": {
                  "$ref": "#/components/schemas/OcrViolationTicket"
                }
              }
            }
          },
          "400": {
            "description": "The uploaded file is too large or the Violation Ticket does not appear to be valid. Either \r\n            the ticket title could not be found, the ticket number is invalid, the violation date is invalid or more than \r\n            30 days ago, or MVA is not selected or not the only ACT selected.",
            "content": {
              "text/plain": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              },
              "text/json": {
                "schema": {
                  "$ref": "#/components/schemas/ProblemDetails"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "BoundingBox": {
        "type": "object",
        "properties": {
          "points": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/Point"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "Field": {
        "type": "object",
        "properties": {
          "value": {
            "type": "string",
            "nullable": true
          },
          "fieldConfidence": {
            "type": "number",
            "format": "float",
            "nullable": true
          },
          "validationErrors": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "A list of field-specific reasons why the field Confidence may be low",
            "nullable": true
          },
          "type": {
            "type": "string",
            "nullable": true
          },
          "boundingBoxes": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/BoundingBox"
            },
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "OcrViolationTicket": {
        "type": "object",
        "properties": {
          "imageFilename": {
            "type": "string",
            "description": "Gets or sets the saved image filename.",
            "nullable": true
          },
          "globalConfidence": {
            "type": "number",
            "description": "A global confidence of correctly extracting the document. This value will be low if the title of this \r\nViolation Ticket form is not found (or of low confidence itself) or if the main ticket number is missing or invalid.",
            "format": "float"
          },
          "fields": {
            "type": "object",
            "additionalProperties": {
              "$ref": "#/components/schemas/Field"
            },
            "description": "An enumeration of all fields in this Violation Ticket.",
            "nullable": true
          }
        },
        "additionalProperties": false,
        "description": "A model representation of the extracted OCR results."
      },
      "Point": {
        "type": "object",
        "properties": {
          "x": {
            "type": "number",
            "format": "float"
          },
          "y": {
            "type": "number",
            "format": "float"
          }
        },
        "additionalProperties": false
      },
      "ProblemDetails": {
        "type": "object",
        "properties": {
          "type": {
            "type": "string",
            "nullable": true
          },
          "title": {
            "type": "string",
            "nullable": true
          },
          "status": {
            "type": "integer",
            "format": "int32",
            "nullable": true
          },
          "detail": {
            "type": "string",
            "nullable": true
          },
          "instance": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": { }
      },
      "Statute": {
        "type": "object",
        "properties": {
          "code": {
            "type": "number",
            "format": "double"
          },
          "act": {
            "type": "string",
            "nullable": true
          },
          "section": {
            "type": "string",
            "nullable": true
          },
          "description": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false,
        "description": "A Statute is a Violation Ticket Fine Regulation as dictated by the BC Government."
      },
      "TicketCount": {
        "type": "object",
        "properties": {
          "offenceDeclaration": {
            "type": "string",
            "nullable": true
          },
          "timeToPayRequest": {
            "type": "boolean"
          },
          "fineReductionRequest": {
            "type": "boolean"
          }
        },
        "additionalProperties": false
      },
      "TicketDispute": {
        "type": "object",
        "properties": {
          "ticketNumber": {
            "type": "string",
            "nullable": true
          },
          "courtLocation": {
            "type": "string",
            "nullable": true
          },
          "violationDate": {
            "type": "string",
            "format": "date-time"
          },
          "disputantSurname": {
            "type": "string",
            "nullable": true
          },
          "givenNames": {
            "type": "string",
            "nullable": true
          },
          "streetAddress": {
            "type": "string",
            "nullable": true
          },
          "province": {
            "type": "string",
            "nullable": true
          },
          "postalCode": {
            "type": "string",
            "nullable": true
          },
          "homePhone": {
            "type": "string",
            "nullable": true
          },
          "emailAddress": {
            "type": "string",
            "nullable": true
          },
          "driversLicence": {
            "type": "string",
            "nullable": true
          },
          "driversLicenceProvince": {
            "type": "string",
            "nullable": true
          },
          "workPhone": {
            "type": "string",
            "nullable": true
          },
          "dateOfBirth": {
            "type": "string",
            "format": "date"
          },
          "enforcementOrganization": {
            "type": "string",
            "nullable": true
          },
          "serviceDate": {
            "type": "string",
            "format": "date"
          },
          "ticketCounts": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TicketCount"
            },
            "nullable": true
          },
          "lawyerRepresentation": {
            "type": "boolean"
          },
          "interpreterLanguage": {
            "type": "string",
            "nullable": true
          },
          "witnessIntent": {
            "type": "boolean"
          },
          "ocrKey": {
            "type": "string",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "TicketOffence": {
        "type": "object",
        "properties": {
          "offenceNumber": {
            "type": "integer",
            "description": "The offence or count number.",
            "format": "int32"
          },
          "ticketedAmount": {
            "type": "number",
            "description": "The ticketed amount for this offence.",
            "format": "double"
          },
          "amountDue": {
            "type": "number",
            "description": "The current amount due.",
            "format": "double"
          },
          "invoiceType": {
            "type": "string",
            "description": "",
            "nullable": true
          },
          "offenceDescription": {
            "type": "string",
            "description": "The description of the offence.",
            "nullable": true
          },
          "vehicleDescription": {
            "type": "string",
            "description": "The description of vehicle.",
            "nullable": true
          }
        },
        "additionalProperties": false
      },
      "TicketSearchResult": {
        "type": "object",
        "properties": {
          "violationTicketNumber": {
            "type": "string",
            "description": "The violation ticket number. This will match the ticket number searched for.",
            "nullable": true
          },
          "violationDate": {
            "type": "string",
            "description": "The date the violation ticket was issued.",
            "format": "date-time"
          },
          "violationTime": {
            "type": "string",
            "description": "The time of day the violation ticket was issued. This will match the time searched for.",
            "nullable": true
          },
          "offences": {
            "type": "array",
            "items": {
              "$ref": "#/components/schemas/TicketOffence"
            },
            "description": "The list of offences on this violation ticket.",
            "nullable": true
          }
        },
        "additionalProperties": false,
        "description": "Obsolete: Represents a violation ticket that is returned from search requests"
      }
    }
  }
}